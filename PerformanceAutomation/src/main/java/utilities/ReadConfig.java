package utilities;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;

/**
 * Created by harshithgn on 12/13/2017.
 */
public class ReadConfig {

    public String appConfigStatus(String keyName) throws Exception {

        String sConfigFilepath = System.getProperty("user.dir")
                + "\\src\\main\\java\\config\\perfAppConfig.xml";
        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
        DocumentBuilder db = dbf.newDocumentBuilder();
        Document doc = db.parse(sConfigFilepath);
        doc.getDocumentElement().normalize();
        NodeList nodeLst = doc.getElementsByTagName("Variable");

        for (int s = 0; s < nodeLst.getLength(); s++) {

            Node keyNode = nodeLst.item(s);

            if (keyNode.getNodeType() == Node.ELEMENT_NODE) {

                Element keyElement = (Element) keyNode;

                NodeList readkey = keyElement.getElementsByTagName("Name");
                Element keyType = (Element) readkey.item(0);

                NodeList readNodekey = keyType.getChildNodes();

                String readKeyName = ((Node) readNodekey.item(0))
                        .getNodeValue().trim();

                // Key found::
                if (keyName.equalsIgnoreCase(readKeyName)) {
                    // mdmLib.logResult(logStatus.LOG_INFO,
                    // "Reading the value of the KEY is: '" + readKeyName +
                    // "'");
                    NodeList readVal = keyElement
                            .getElementsByTagName("Value");
                    Element ValueType = (Element) readVal.item(0);

                    NodeList readValue = ValueType.getChildNodes();
                    // when NO value::
                    if (readValue.item(0) == null) {
                        // mdmLib.logResult(logStatus.LOG_FAIL, "Value of '"
                        // + readKeyName + "' is not found in XML file");
                        return null;
                    }
                    keyName = ((Node) readValue.item(0)).getNodeValue()
                            .trim();

                    // when value is there, but it is Empty::
                    if (keyName.isEmpty() || (keyName == null)) {
                        // mdmLib.logResult(logStatus.LOG_FAIL, "'" +
                        // keyName + "' is empty of the '" + readKeyName +
                        // "' in XML file...");
                        return null;
                    }
                    // mdmLib.logResult(logStatus.LOG_PASS, "'" + keyName +
                    // "' is the value of the key '" + readKeyName + "'");
                    break;
                } else {
                    // When Key not found::
                    if (s == nodeLst.getLength() - 1) {
                        // mdmLib.logResult(logStatus.LOG_FAIL,
                        // "KEY does not exist in XML file");
                        return null;
                    }

                }
            }

        }


        return keyName;
    }
}
