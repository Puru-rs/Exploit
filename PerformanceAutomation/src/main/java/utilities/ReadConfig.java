package utilities;

import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Row;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import java.io.File;
import java.io.FileInputStream;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

/**
 * Created by harshithgn on 12/13/2017.
 */
public class ReadConfig {

    public String appConfigStatus(String keyName) throws Exception {

        String sConfigFilepath = System.getProperty("user.dir")
                + "\\src\\main\\java\\config\\perfAppConfig.xml";
        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
        DocumentBuilder db = dbf.newDocumentBuilder();
        Document doc = db.parse(sConfigFilepath);
        doc.getDocumentElement().normalize();
        NodeList nodeLst = doc.getElementsByTagName("Variable");

        for (int s = 0; s < nodeLst.getLength(); s++) {

            Node keyNode = nodeLst.item(s);

            if (keyNode.getNodeType() == Node.ELEMENT_NODE) {

                Element keyElement = (Element) keyNode;

                NodeList readkey = keyElement.getElementsByTagName("Name");
                Element keyType = (Element) readkey.item(0);

                NodeList readNodekey = keyType.getChildNodes();

                String readKeyName = ((Node) readNodekey.item(0))
                        .getNodeValue().trim();

                // Key found::
                if (keyName.equalsIgnoreCase(readKeyName)) {
                    // mdmLib.logResult(logStatus.LOG_INFO,
                    // "Reading the value of the KEY is: '" + readKeyName +
                    // "'");
                    NodeList readVal = keyElement
                            .getElementsByTagName("Value");
                    Element ValueType = (Element) readVal.item(0);

                    NodeList readValue = ValueType.getChildNodes();
                    // when NO value::
                    if (readValue.item(0) == null) {
                        // mdmLib.logResult(logStatus.LOG_FAIL, "Value of '"
                        // + readKeyName + "' is not found in XML file");
                        return null;
                    }
                    keyName = ((Node) readValue.item(0)).getNodeValue()
                            .trim();

                    // when value is there, but it is Empty::
                    if (keyName.isEmpty() || (keyName == null)) {
                        // mdmLib.logResult(logStatus.LOG_FAIL, "'" +
                        // keyName + "' is empty of the '" + readKeyName +
                        // "' in XML file...");
                        return null;
                    }
                    // mdmLib.logResult(logStatus.LOG_PASS, "'" + keyName +
                    // "' is the value of the key '" + readKeyName + "'");
                    break;
                } else {
                    // When Key not found::
                    if (s == nodeLst.getLength() - 1) {
                        // mdmLib.logResult(logStatus.LOG_FAIL,
                        // "KEY does not exist in XML file");
                        return null;
                    }

                }
            }

        }


        return keyName;
    }

    public List<String> getHelpContent(){
        List<String> helpData = new ArrayList<String>();
        try {
            //this.fileName = fileName;
            File f = new File(System.getProperty("user.dir") + "\\inputfiles\\Master.xls");
            FileInputStream ios = new FileInputStream(f);
            HSSFWorkbook workbook = new HSSFWorkbook(ios);
            HSSFSheet sheet = workbook.getSheet("Help");

            helpData.add(workbook.getSheet("Help").getRow(5).getCell(1).toString());
            helpData.add(workbook.getSheet("Help").getRow(6).getCell(1).toString());
            helpData.add(workbook.getSheet("Help").getRow(10).getCell(1).toString());
            helpData.add(workbook.getSheet("Help").getRow(11).getCell(1).toString());
            helpData.add(workbook.getSheet("Help").getRow(12).getCell(1).toString());
            helpData.add(workbook.getSheet("Help").getRow(14).getCell(1).toString());

            ios.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return helpData;
    }

    public List<String> getMailRecipients(int columnIndex){
        List<String> mailRecData = new ArrayList<String>();
        try {
            //this.fileName = fileName;
            File f = new File(System.getProperty("user.dir") + "\\inputfiles\\Master.xls");
            FileInputStream ios = new FileInputStream(f);
            HSSFWorkbook workbook = new HSSFWorkbook(ios);
            HSSFSheet sheet = workbook.getSheet("Mail Recipients");

            Iterator<Row> rowIterator = sheet.iterator();

            while (rowIterator.hasNext()) {
                Row row = rowIterator.next();
                Iterator<Cell> cellIterator = row.cellIterator();
                while (cellIterator.hasNext()) {
                    Cell cell = cellIterator.next();

                    if(row.getRowNum() > 0){ //To filter column headings
                        if(cell.getColumnIndex() == columnIndex){// To match column index
                            switch (cell.getCellType()) {
                                case Cell.CELL_TYPE_NUMERIC:
                                    mailRecData.add(cell.getNumericCellValue()+"");
                                    break;
                                case Cell.CELL_TYPE_STRING:
                                    mailRecData.add(cell.getStringCellValue());
                                    break;
                            }
                        }
                    }
                }
            }
            ios.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return mailRecData;
    }

    public List<String> getMailCredentials(int columnIndex){
        List<String> mailCredData = new ArrayList<String>();
        try {
            //this.fileName = fileName;
            File f = new File(System.getProperty("user.dir") + "\\inputfiles\\Master.xls");
            FileInputStream ios = new FileInputStream(f);
            HSSFWorkbook workbook = new HSSFWorkbook(ios);
            HSSFSheet sheet = workbook.getSheet("Mail Credentials");

            Iterator<Row> rowIterator = sheet.iterator();

            while (rowIterator.hasNext()) {
                Row row = rowIterator.next();
                Iterator<Cell> cellIterator = row.cellIterator();
                while (cellIterator.hasNext()) {
                    Cell cell = cellIterator.next();

                    if(row.getRowNum() > 0){ //To filter column headings
                        if(cell.getColumnIndex() == columnIndex){// To match column index
                            switch (cell.getCellType()) {
                                case Cell.CELL_TYPE_NUMERIC:
                                    mailCredData.add(cell.getNumericCellValue()+"");
                                    break;
                                case Cell.CELL_TYPE_STRING:
                                    mailCredData.add(cell.getStringCellValue());
                                    break;
                            }
                        }
                    }
                }
            }
            ios.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return mailCredData;
    }
}
