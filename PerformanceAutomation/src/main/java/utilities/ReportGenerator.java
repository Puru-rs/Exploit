package utilities;

import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.IndexedColors;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.xssf.usermodel.*;
import org.apache.poi.ss.usermodel.*;

import org.apache.poi.xssf.usermodel.XSSFWorkbook;

import java.awt.*;
import java.awt.Color;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.List;
import java.util.regex.Pattern;

/**
 * Created by harshithgn on 12/12/2017.
 */
@SuppressWarnings("ALL")
public class ReportGenerator {

    ReadConfig objReadConfig = new ReadConfig();
    XSSFColor blueGrey =new XSSFColor(new java.awt.Color(51, 63, 79));
    XSSFColor lightWhite =new XSSFColor(new java.awt.Color(217, 217, 217));
    XSSFColor passFailFontColor =new XSSFColor(new java.awt.Color(242, 242, 242));
    XSSFColor greenBckGrnd = new XSSFColor(new java.awt.Color(112, 173, 71));
    XSSFColor resultBckGrnd = new XSSFColor(new Color(252, 228, 214));

    public String writeToExcel(List<String> report, List<String> reportGenTime, List<String> actualCount) throws Exception {

        ReadConfig objReadConfig = new ReadConfig();
        String instanceName = objReadConfig.appConfigStatus("Instance");

        String fileName = new SimpleDateFormat("dd_MMM_yyyy_HH_mm_ss_aa").format(Calendar.getInstance().getTime());

        String FILE_NAME = System.getProperty("user.dir") + "\\testReport\\" + instanceName + "_" + fileName + ".xlsx";

        XSSFWorkbook workbook = new XSSFWorkbook();
        XSSFSheet sheet = workbook.createSheet("Performance Report");

        XSSFCellStyle borderStyle = workbook.createCellStyle();
        borderStyle.setBorderLeft(BorderStyle.THIN);
        borderStyle.setBorderRight(BorderStyle.THIN);
        borderStyle.setBorderTop(BorderStyle.THIN);
        borderStyle.setBorderBottom(BorderStyle.THIN);
        borderStyle.setFillForegroundColor(resultBckGrnd);
        borderStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);

        int rowNum = 0;
        System.out.println("Generating Performance Report...!");
        for (int i = 0; i<=report.size(); i++) {
            if(i==0){
                XSSFCellStyle style = workbook.createCellStyle();

                style.setFillForegroundColor(blueGrey);
                style.setFillPattern(FillPatternType.SOLID_FOREGROUND);
                style.setAlignment(HorizontalAlignment.CENTER);
                style.setVerticalAlignment(VerticalAlignment.CENTER);
                style.setBorderLeft(BorderStyle.THIN);
                style.setBorderRight(BorderStyle.THIN);
                style.setBorderTop(BorderStyle.THIN);
                style.setBorderBottom(BorderStyle.THIN);

                XSSFFont font = workbook.createFont();
                font.setColor(lightWhite);
                font.setBold(true);
                style.setFont(font);

                Row row = sheet.createRow(i);
                int headerHeight = 2 * row.getHeight();
                row.setHeight((short) headerHeight);
                Cell cell1 = row.createCell(0);
                cell1.setCellValue(new XSSFRichTextString("Test Case #"));
                cell1.setCellStyle(style);

                Cell cell2 = row.createCell(1);
                cell2.setCellValue((String)"Time Taken");
                cell2.setCellStyle(style);

                Cell cell3 = row.createCell(2);
                cell3.setCellValue((String)"Instance");
                cell3.setCellStyle(style);

                Cell cell4 = row.createCell(3);
                cell4.setCellValue((String)"Backup Directory Names");
                cell4.setCellStyle(style);

                Cell cell5 = row.createCell(4);
                cell5.setCellValue((String)"Actual Count");
                cell5.setCellStyle(style);

                Cell cell6 = row.createCell(5);
                cell6.setCellValue((String)"Status");
                cell6.setCellStyle(style);
            }
            else {
                XSSFCellStyle passStyle = passStyle(workbook, sheet);

                XSSFCellStyle failStyle = failStyle(workbook, sheet);

                String scenario = report.get(i-1).split(Pattern.quote("||"))[0].trim().toString();
                String timeTaken = report.get(i-1).split(Pattern.quote("||"))[1].trim().toString();
                int expCount = Integer.parseInt(actualCount.get(i-1).split(Pattern.quote("||"))[0].trim().toString());
                int actCount = Integer.parseInt(actualCount.get(i-1).split(Pattern.quote("||"))[1].trim().toString());
                String dirFolderName = reportGenTime.get(i-1).toString().trim();
                Row row = sheet.createRow(i);

                for (int j=0; j<6; j++) {
                    Cell cell = row.createCell(j);
                    if(j==0) {
                        cell.setCellValue((String) scenario);
                        cell.setCellStyle(borderStyle);
                    } else if (j==1) {
                        cell.setCellValue((String) timeTaken);
                        cell.setCellStyle(borderStyle);
                    } else if (j==2) {
                        cell.setCellValue(objReadConfig.appConfigStatus("Instance").toString().trim());
                        cell.setCellStyle(borderStyle);
                    } else if (j==3){
                        cell.setCellValue(dirFolderName);
                        cell.setCellStyle(borderStyle);
                    } else if (j==4){
                        cell.setCellValue(actCount);
                        cell.setCellStyle(borderStyle);
                    } else if (j==5) {
                        if(actCount >= expCount){
                            cell.setCellValue("Pass");
                            cell.setCellStyle(passStyle);
                        } else {
                            cell.setCellValue("Fail");
                            cell.setCellStyle(failStyle);
                        }
                    }
                    sheet.autoSizeColumn(j);
                }
            }
        }


        FileOutputStream outputStream = new FileOutputStream(FILE_NAME);
        workbook.write(outputStream);
        workbook.close();

        return fileName;
    }

    public XSSFCellStyle passStyle(XSSFWorkbook workbook, XSSFSheet sheet) {

        XSSFCellStyle passStyle = workbook.createCellStyle();
        passStyle.setFillForegroundColor(greenBckGrnd);
        passStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);
        passStyle.setBorderLeft(BorderStyle.THIN);
        passStyle.setBorderRight(BorderStyle.THIN);
        passStyle.setBorderTop(BorderStyle.THIN);
        passStyle.setBorderBottom(BorderStyle.THIN);

        XSSFFont passFont = workbook.createFont();
        passFont.setColor(passFailFontColor );
        passFont.setBold(true);
        passStyle.setFont(passFont);
        return passStyle;
    }

    public XSSFCellStyle failStyle(XSSFWorkbook workbook, XSSFSheet sheet) {
        XSSFCellStyle failStyle = workbook.createCellStyle();
        failStyle.setFillForegroundColor(IndexedColors.RED.getIndex());
        failStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);
        failStyle.setBorderLeft(BorderStyle.THIN);
        failStyle.setBorderRight(BorderStyle.THIN);
        failStyle.setBorderTop(BorderStyle.THIN);
        failStyle.setBorderBottom(BorderStyle.THIN);

        XSSFFont failFont = workbook.createFont();
        failFont.setColor(passFailFontColor );
        failFont.setBold(true);
        failStyle.setFont(failFont);
        return failStyle;
    }
}
