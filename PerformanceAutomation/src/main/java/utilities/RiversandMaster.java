package utilities;

import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;

import java.io.*;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.regex.Pattern;

/**
 * Created by harshithgn on 12/7/2017.
 */
@SuppressWarnings("ALL")
public class RiversandMaster {

    public List<String> readQueryBuilder(String SheetName, int RowNumber, HSSFWorkbook workbook) throws Exception {
        List<String> queryBuilder = new ArrayList<String>();

        // Get first/desired sheet from the workbook
        HSSFSheet sheet = readExcelWorkbook("inputFiles\\Master.xls", "Performance Test Suite");
        HSSFRow row = sheet.getRow(RowNumber);
        String executionMode = row.getCell(0).toString();
        if (executionMode.equalsIgnoreCase("Yes")) {   //if execution mode is yes then read row and continue
            try {
                queryBuilder.add(0, sheet.getRow(RowNumber).getCell(1).getStringCellValue().toString());    //test cas #
                queryBuilder.add(1, sheet.getRow(RowNumber).getCell(5).getStringCellValue().toString());    // JSON input path
                queryBuilder.add(2,sheet.getRow(RowNumber).getCell(12).getStringCellValue().toString());    // File name for json generation
                queryBuilder.add(3, sheet.getRow(RowNumber).getCell(13).getStringCellValue().toString());   //kinesis kit query
                queryBuilder.add(4, sheet.getRow(RowNumber).getCell(9).getStringCellValue().toString());    //Start first get entity call
                queryBuilder.add(5, sheet.getRow(RowNumber).getCell(10).getStringCellValue().toString());   //pooling time to call get entity call
                queryBuilder.add(6, sheet.getRow(RowNumber).getCell(11).getStringCellValue().toString());   //Stop get entity call time
            } catch (Exception expt) {
                expt.printStackTrace();
            }
        }

        return queryBuilder;   //return row
    }

    public static List<String> readRequstBuilder(String SheetName, HSSFWorkbook workbook, String caseNo) throws Exception {
        List<String> requestBuilder = new ArrayList<String>();

        HSSFSheet sheet = workbook.getSheet(SheetName);
        int getJSONDataRowCount = getRowCount("JSON Data", workbook);

        for(int i=1; i<=getJSONDataRowCount; i++) {
            String jsonSheetCaseNo = sheet.getRow(i).getCell(0).toString();
            if (jsonSheetCaseNo.equalsIgnoreCase(caseNo)) {   //if execution mode is yes then read row and continue
                try {
                    requestBuilder.add(0, sheet.getRow(i).getCell(1).getStringCellValue().toString());   //content Type
                    requestBuilder.add(1, sheet.getRow(i).getCell(2).getStringCellValue().toString());   // Headers
                    requestBuilder.add(2, sheet.getRow(i).getCell(3).getStringCellValue().toString());   // API URL
                    requestBuilder.add(3, sheet.getRow(i).getCell(6).getStringCellValue().toString());   //Request Json
                    requestBuilder.add(4, sheet.getRow(i).getCell(7).getStringCellValue().toString());   //Expected entity count
                    break;
                } catch (Exception expt) {
                    expt.printStackTrace();
                }
            }
        }

        return requestBuilder;   //return json query
    }

    public static int getRowCount(String SheetName, HSSFWorkbook workbook) throws Exception {
        int rowCount = 0;

        HSSFSheet sheet = workbook.getSheet(SheetName);
        rowCount = sheet.getLastRowNum();

        return rowCount;
    }

    public static int getColCount(String SheetName, HSSFWorkbook workbook) throws Exception {
        int CollCount = 0;

        HSSFSheet sheet = workbook.getSheet(SheetName);
        CollCount = sheet.getRow(0).getPhysicalNumberOfCells();

        return CollCount;
    }

    public static List<String> ReadExcel(String SheetName, String Entity, HSSFWorkbook workbook) throws Exception {
        List<String> ExcelData = new ArrayList<String>();
        List<String> JsonData = new ArrayList<String>();
        List<String> Result = new ArrayList<String>();

        // Get first/desired sheet from the workbook
        HSSFSheet sheet = workbook.getSheet(SheetName);
        int row = sheet.getLastRowNum();
        int CellType = 0;
        String CellValue = null;
        int TempCellValue = 0;
        Double NumericCellValue;

        for (int i = 1; i <= row; i++) {
            HSSFRow r = sheet.getRow(i);
            for (int j = 0; j < sheet.getRow(i).getLastCellNum(); j++) {

                String s = sheet.getRow(i).getCell(0).toString();
                if (s.equals(Entity)) {
                    CellType = r.getCell(j).getCellType();
                    switch (CellType) {
                        case 0:
                            NumericCellValue = r.getCell(j).getNumericCellValue();
                            TempCellValue = NumericCellValue.intValue();
                            CellValue = Integer.toString(TempCellValue);
                            ExcelData.add(CellValue);
                            break;
                        case 1:
                            CellValue = r.getCell(j).toString();
                            ExcelData.add(CellValue);
                            break;
                        default:
                            System.out.println("Unknown Cell Type");
                    }
                }

            }
            if (SheetName.equals("Attribute")) {
                if (ExcelData.isEmpty()) {

                } else {
                    String value = "";
                    for (int m = 0; m < ExcelData.size(); m++) {
                        value = value.concat("::" + ExcelData.get(m).toString());
                    }
                    JsonData.add(value);
                    ExcelData.clear();
                }
                Result = JsonData;
            }
            if (SheetName.equals("Relationship")) {
                if (ExcelData.isEmpty()) {

                } else {
                    String value = "";
                    for (int m = 0; m < ExcelData.size(); m++) {
                        value = value.concat("::" + ExcelData.get(m).toString());
                    }
                    JsonData.add(value);
                    ExcelData.clear();
                }
                Result = JsonData;
            }
            if (SheetName.equals("Extension")) {
                if (ExcelData.isEmpty()) {

                } else {
                    String value = "";
                    for (int m = 0; m < ExcelData.size(); m++) {
                        value = value.concat("::" + ExcelData.get(m).toString());
                    }
                    JsonData.add(value);
                    ExcelData.clear();
                }
                Result = JsonData;
            }
            if (SheetName.equals("ExtensionRelationship")) {
                if (ExcelData.isEmpty()) {

                } else {
                    String value = "";
                    for (int m = 0; m < ExcelData.size(); m++) {
                        value = value.concat("::" + ExcelData.get(m).toString());
                    }
                    JsonData.add(value);
                    ExcelData.clear();
                }
                Result = JsonData;
            }
        }

        System.out.println();

        return Result;
    }

    public static List<String> GetAttributes(HSSFWorkbook workbook, String SheetName, int RowNumber) throws Exception {
        List<String> ExcelData = new ArrayList<String>();

        // Get first/desired sheet from the workbook
        HSSFSheet sheet = workbook.getSheet(SheetName);
        int CellType = 0;
        String CellValue = null;
        String AttrName = null;
        String attr = null;
        int TempCellValue = 0;
        Double NumericCellValue;
        HSSFRow firstRow = sheet.getRow(0);
        HSSFRow r = sheet.getRow(RowNumber);
        sheet.getRow(RowNumber).getLastCellNum();
        for (int j = 1; j < sheet.getRow(RowNumber).getLastCellNum(); j++) {
            CellType = r.getCell(j).getCellType();
            switch (CellType) {
                case 0:
                    NumericCellValue = r.getCell(j).getNumericCellValue();
                    TempCellValue = NumericCellValue.intValue();
                    CellValue = Integer.toString(TempCellValue);
                    if (!CellValue.equals("NA")) {
                        AttrName = firstRow.getCell(j).toString();
                        attr = AttrName + "##" + CellValue;
                        ExcelData.add(attr);
                        System.out.println(ExcelData);
                    }
                    break;
                case 1:
                    CellValue = r.getCell(j).toString();
                    if (!CellValue.equals("NA")) {
                        AttrName = firstRow.getCell(j).toString();
                        attr = AttrName + "##" + CellValue;
                        ExcelData.add(attr);
                        // System.out.println(ExcelData);
                    }
                    break;
                default:
                    System.out.println("Unknown Cell Type");
            }
        }
        System.out.println(ExcelData);

        return ExcelData;

    }

    public static List<String> ReadMetadata(String SheetName, int RowNumber, HSSFWorkbook workbook) throws Exception {
        List<String> ExcelData = new ArrayList<String>();

        int CellType;
        Double NumericCellValue;
        int TempCellValue = 0;
        String CellValue = null;
        String[] ary = null;
        String Value = null;

        // Get first/desired sheet from the workbook
        HSSFSheet sheet = workbook.getSheet(SheetName);
        HSSFRow row = sheet.getRow(RowNumber);
        HSSFRow Headerrow = sheet.getRow(0);
        String Header = null;

        for (int j = 0; j < Headerrow.getPhysicalNumberOfCells(); j++) {
            try {
                CellType = row.getCell(j).getCellType();

                if (CellType > -1) {
                    switch (CellType) {
                        case 0:
                            Header = Headerrow.getCell(j).toString();
                            NumericCellValue = row.getCell(j).getNumericCellValue();
                            String stringCellValue = NumericCellValue.toString();
                            ary = stringCellValue.split(Pattern.quote("."));
                            int wholeNum = Integer.parseInt(ary[0]);
                            if (NumericCellValue % wholeNum == 0) {
                                Value = Header + "$" + ary[0];
                            } else {
                                Value = Header + "$" + NumericCellValue;
                            }
                            ExcelData.add(Value);
                            break;
                        case 1:
                            Header = Headerrow.getCell(j).toString();
                            CellValue = row.getCell(j).toString();
                            if (CellValue.equals("NA")) {

                            } else {
                                String Value1 = Header + "$" + CellValue;
                                ExcelData.add(Value1);
                            }
                            break;
                        case 3:
                            Header = Headerrow.getCell(j).toString();
                            CellValue = row.getCell(j).toString();
                            String emptyValue = Header + "$" + CellValue;
                            ExcelData.add(emptyValue);
                            break;
                        default:
                            // System.out.println("Unknown Cell Type");
                    }
                }
            } catch (Exception expt) {
                Header = Headerrow.getCell(j).toString();
                CellValue = "ignore";
                String emptyValue = Header + "$" + CellValue;
                ExcelData.add(emptyValue);
                continue;
            }
        }

        return ExcelData;
    }

    public HSSFSheet readExcelWorkbook(String fileNameWithCurDirFolderPath, String sheetName) throws Exception {
        HSSFWorkbook workbook = null;
        HSSFSheet sheet = null;
        for (int nf = 1; nf <= 1; nf++) {
            String excelFilePath = System.getProperty("user.dir") + "\\" + fileNameWithCurDirFolderPath;

            FileInputStream inputStream;

            inputStream = new FileInputStream(new File(excelFilePath));
            workbook = new HSSFWorkbook(inputStream);
            sheet = workbook.getSheet(sheetName);


        }
        return sheet;
    }

    public String diffBetweenTwoDates(Date startTime, Date endTime) throws Exception {
        String dateDiff = null;

        Date perfStartTime = startTime;
        Date perfEndTime = endTime;

        long difference = perfEndTime.getTime() - perfStartTime.getTime();

        long differenceSeconds = difference / 1000 % 60;
        long differenceMinutes = difference / (60 * 1000) % 60;
        long differenceHours = difference / (60 * 60 * 1000) % 24;

        dateDiff = differenceHours + " hrs : " + differenceMinutes + " mins : " + differenceSeconds + " secs";
        System.out.println(dateDiff);


        return dateDiff;
    }

    public void logStatus(String fileName, String msg) throws Exception {
        BufferedWriter bw = null;
        FileWriter fw = null;
        try {
            File file = new File(fileName);
            if (!file.exists()) {
                file.createNewFile();
            }
            fw = new FileWriter(file.getAbsoluteFile(), true);
            bw = new BufferedWriter(fw);
            bw.write(msg);
            bw.write(" <br>");
            bw.write(" <br>");
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            try {
                if (bw != null)
                    bw.close();
                if (fw != null)
                    fw.close();
            } catch (IOException ex) {
                ex.printStackTrace();
            }
        }
    }
}
