<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="WARN" packages="org.apache.logging.log4j.core.layout" monitorInterval="30">
    <Properties>
        <Property name="pattern">%d{ISO8601} [%level] [%X{requestId}] [%X{GUID}] [%X{tenantId}] [%X{callerServiceName}]
            [%X{calleeServiceName}] [%X{relatedRequestId}] [%X{groupRequestId}] [%X{userId}] [%X{entityId}] [%c{1.}]
            [%X{method}] [%X{inclusiveTime}] %msg ThreadId - %t%n
        </Property>
        <Property name="patternNoTime">%msg%n</Property>
        <Property name="rs.logging.dir">./logs/</Property> <!-- default value, used if the system property is not set -->
    </Properties>
    <Appenders>
        <!--<Console name="console" target="SYSTEM_OUT">
            <PatternLayout>
                <Pattern>${patternNoTime}</Pattern>
            </PatternLayout>
        </Console>-->
        <RollingRandomAccessFile name="dataplatformLogFile"
                                 fileName="${sys:rs.logging.dir}dataplatformLogs.log"
                                 filePattern="${sys:rs.logging.dir}archive/dataplatformLogs-%d{MM-dd-yyyy}-%i.log.gz"
                                 append="true">
            <PatternLayout>
                <Pattern>${pattern}</Pattern>
            </PatternLayout>
            <Policies>
                <TimeBasedTriggeringPolicy/>
                <SizeBasedTriggeringPolicy size="50 MB"/>
            </Policies>
            <DefaultRolloverStrategy max="20">
                <Delete basePath="${sys:rs.logging.dir}archive/">
                    <IfFileName glob="dataplatformLogs-*.log.gz"/>
                    <IfLastModified age="8d"/>
                </Delete>
            </DefaultRolloverStrategy>
        </RollingRandomAccessFile>
        <RollingRandomAccessFile name="techserviceLogFile"
                                 fileName="${sys:rs.logging.dir}techserviceLogs.log"
                                 filePattern="${sys:rs.logging.dir}archive/techserviceLogs-%d{MM-dd-yyyy}-%i.log.gz"
                                 append="true">
            <PatternLayout>
               <!-- This is a different pattern as the service context is not available to these -->
                <Pattern>%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n</Pattern>
            </PatternLayout>
            <Policies>
                <TimeBasedTriggeringPolicy/>
                <SizeBasedTriggeringPolicy size="250 MB"/>
            </Policies>
            <DefaultRolloverStrategy max="20">
                <Delete basePath="${sys:rs.logging.dir}archive/">
                    <IfFileName glob="techserviceLogs-*.log.gz"/>
                    <IfLastModified age="8d"/>
                </Delete>
            </DefaultRolloverStrategy>
        </RollingRandomAccessFile>
    </Appenders>
    <Loggers>
        <!-- Write all the technology service entries to their own log file -->
        <Logger name="org.apache" level="ERROR" additivity="false">
            <AppenderRef ref="techserviceLogFile"/>
        </Logger>
        <Logger name="org.apache.storm" level="ERROR" additivity="false">
            <AppenderRef ref="techserviceLogFile"/>
        </Logger>
        <Logger name="org.apache.zookeeper" level="ERROR" additivity="false">
            <AppenderRef ref="techserviceLogFile"/>
        </Logger>
        <Logger name="kafka.network" level="ERROR" additivity="false">
            <AppenderRef ref="techserviceLogFile"/>
        </Logger>
        <Logger name="org.apache.kafka" level="ERROR" additivity="false">
            <AppenderRef ref="techserviceLogFile"/>
        </Logger>
        <Logger name="storm.kafka" level="ERROR" additivity="false">
            <AppenderRef ref="techserviceLogFile"/>
        </Logger>
        <Logger name="backtype.storm" level="ERROR" additivity="false">
            <AppenderRef ref="techserviceLogFile"/>
        </Logger>
        <Logger name="org.elasticsearch" level="ERROR" additivity="false">
            <AppenderRef ref="techserviceLogFile"/>
        </Logger>
        <Logger name="org.apache.hadoop" level="ERROR" additivity="false">
            <AppenderRef ref="techserviceLogFile"/>
        </Logger>
        <!-- For Netty its at Info level -->
        <Logger name="io.netty" level="INFO" additivity="false">
            <AppenderRef ref="techserviceLogFile"/>
        </Logger>        

        <!-- Write all our application-level entries to their own log file -->
        <Root level="INFO">
            <AppenderRef ref="dataplatformLogFile"/>
            <!--<AppenderRef ref="console"/>-->
        </Root>

        <!-- Debugging: if you are debugging a component and want to filter out all
             messages except those from your component, you can uncomment the following
             and change the Logger name to the namespace of the component in question;
             you will also likely want to change the level for the Root logger above
             to WARN or above, to eliminate most messages from other components. -->
        <!--
        <Logger name="com.riversand.dataplatform.fs.eventmanagesvc.topology" level="TRACE" additivity="false">
            <AppenderRef ref="dataplatformLogFile"/>
        </Logger>
        -->
    </Loggers>
</Configuration>
